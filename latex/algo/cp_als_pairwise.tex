\begin{algorithmic}[1]
    \Function{$\{\M{A}_{k}\}=$ CP-ALS-PAIRWISE-QR}{$\T{X},r$}
      \For{$l = 1, \dots, d$}
      \State Init $\mat{A}_l$
      \State $[\mat{Q}_l,\mat{R}_l] = \Call{QR}{\mat{A}_l}$ \Comment{Factor QR}
      \EndFor
      \While{not converge}
      \For{$k = 1, \dots, d$}
        \State $\T{Y} =  \T{X} \times_1 \mat{Q}_1^\top \dots \times_{k-1} \mat{Q}_{k-1}^\top \times_{k+1} \mat{Q}_{k+1}^\top \dots \times_d \mat{Q}_d^\top$ \label{l:Pair-TTM} \Comment{Multi-TTM}
        \State Permute $\T[]{Y}$ to $\mathbb{R}^{r \times \cdots \times n}$
        \State \AZ{needs revise} 
        \IfThenElse{$k\neq 1$}{$z=1$}{$z=2$}
        \State $\mat{R} = \mat{R}_z$
        \For{$l = 1, \dots, d$} \Comment{Pairwise QR}
        \State $[\mat{Q}_l,\mat{R}] = \Call{QR}{\mat{R} \odot \mat{R}_l}$
        \State $\T{Y}= \Call{collapse}{\T{Y}}$
        \State $\T[]{Y} = \T[]{Y} \times_1 \mat{Q}_l^\top$ \Comment{TTM} \label{l:pair-R-TTM}

        \EndFor
              
      \State Solve $  \mat{\hat{A}}_k\mat{R}^\top = \mat{Y}_{(k)}$ for $\mat{A}_k$ \Comment{via TRSM}
      
      \State $[\mat{Q}_k,\mat{R}_k] = \Call{QR}{\mat{A}_k}$ \Comment{Update $\mat{Q}_k\mat{R}_k$}  
      \EndFor
      \EndWhile
    \EndFunction
  \end{algorithmic}
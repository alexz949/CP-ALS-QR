\begin{algorithmic}[1]
    \Function{$\{\M{A}_{n}\}=$ CP-ALS}{$\T{X},r$}
      \State Setup factor matrices  $\mat{A}_1$, $\mat{A}_2$, $\dots$, $\mat{A}_d$
      \State Compute QR decomposition for factor matrices $\mat{Q}_d\mat{R}_d, \dots \mat{Q}_1\mat{R}_1$
      \While{not converge}
      \For{$k = 1, \dots, d$}
      %\State Compute QR factorization $\mat{Q}_0\mat{R}_0$ for Khatri-Rao product of $\mat{R}_N, \dots, \mat{R}_1$
      \State $[\mat{Q}_0,\mat{R}_0] = \Call{QR}{\mat{R}_d \odot \cdots \odot \mat{R}_{k+1} \odot \mat{R}_{k-1} \odot \cdots \odot \mat{R}_1}$
      \State $\T{Y} =  \T{X} \times_1 \mat{Q}_1^\top \dots \times_{k-1} \mat{Q}_{k-1}^\top \times_{k+1} \mat{Q}_{k+1}^\top \dots \times_d \mat{Q}_d^\top$ \Comment{Multi-TTM} \label{l:EXP-TTM}
      \State $\mat{U}_k = \mat{Y}_{(k)}\mat{Q}_0$ \label{l:apply}
      \State $\mat{\hat{A}_k} = \mat{R}_0^\top \text{\textbackslash} \mat{U}_k$ \Comment{via Cholesky}
      \State $[\mat{Q}_k,\mat{R}_k] = \Call{QR}{\mat{A}_k}$ \Comment{Update $\mat{A}_k$ and $\mat{Q}_k\mat{R}_k$}     
      \EndFor
      \EndWhile
    \EndFunction
  \end{algorithmic}